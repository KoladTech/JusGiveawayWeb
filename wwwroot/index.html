<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JusGiveaway</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="JusGiveawayWebApp.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <div class="loading-splash">
            <img src="images/splash.png" alt="Splash Image" class="splash-image" />
            <div class="loading-progress">
                <svg viewBox="0 0 36 36">
                    <circle cx="18" cy="18" r="16"></circle>
                    <circle cx="18" cy="18" r="16"></circle>
                </svg>
                <div class="loading-progress-text"></div>
            </div>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/TG.Blazor.IndexedDB/indexedDb.Blazor.js"></script>
    <script>
        window.onPageExit = function (callback) {
            // Listen for back button press (popstate event)
            window.addEventListener('popstate', function (event) {
                console.log("Back button pressed...");
                callback.invokeMethodAsync('HandleBackButtonPress');
            });

            // Attach the beforeunload event listener for other exits
            window.addEventListener('beforeunload', function (event) {
                // Prevents default browser prompt from showing up
                event.preventDefault();
                console.log("Page is about to exit...");
                callback.invokeMethodAsync('SaveProgressOnExit');
            });
        };
    </script>
    <script>
        let timer;
        let isUserLoggedOut = false; // Add a flag to track logout state

        window.inactivityTimer = function (dotNetHelper) {
            if (!dotNetHelper || isUserLoggedOut) {
                console.error("DotNetHelper is undefined. or userLoggedout");
                return;
            }
;
            let timer;
            //10 mins * 60 secs/min * 1000 milliseconds/sec = 600,000 milliseconds
            let logoutAfter = 10 * 60 * 1000; 


            // Reset the timer on any user activity
            // Add event listeners for both desktop and mobile devices
            window.onload = resetTimer;
            document.onmousemove = resetTimer;  // Mouse movement (desktop)
            document.onkeydown = resetTimer;    // Keypress (desktop)
            document.onclick = resetTimer;      // Clicks (desktop)
            document.ontouchstart = resetTimer; // Touch (mobile)
            document.ontouchmove = resetTimer;  // Scrolling/touch movement (mobile)
            document.onscroll = resetTimer;     // Scrolling (both desktop and mobile)
                        

            // Log the user out when time expires
            function logoutUser() {
                if (!isUserLoggedOut) {
                    // Call the Blazor method using the DotNetHelper
                    dotNetHelper.invokeMethodAsync('LogoutUser')
                        .catch(err => console.error("Error invoking LogoutUser:", err));
                    console.error("inside logoutUser js func.");
                }
            }

            // Reset the inactivity timer
            function resetTimer() {
                if (!isUserLoggedOut) {
                    clearTimeout(timer);
                    timer = setTimeout(logoutUser, logoutAfter);
                    //console.error("inside resetTimer js func.");
                }
            }
        };
        window.clearInactivityTimer = function () {
            clearTimeout(inactivityTimer);
            inactivityTimer = null; // Clear the timer when logged out
            console.error("inside clearInactivityTimer js func.");
            isUserLoggedOut = true; // Set the flag to stop further timer setups
        };

        window.resetUserLoggedOutFlag = function () {
            isUserLoggedOut = false; // Reset the flag when the user logs back in
            console.log("inside resetUserLoggedOutFlag")
        };
    </script>


</body>

</html>
